# CLAUDE.md - ZeroBias Suite Monorepo Guide

## Repository Overview
This is a monorepo containing 200+ suites for the ZeroBias platform. Suites fall into several categories:

1. **Vendor Product Suites**: Technology products and services (AWS, Azure, Microsoft 365, Google Workspace, Atlassian, etc.)
2. **Compliance & Security Frameworks**: Standards like ISO 27001, NIST 800-53, SOC2, PCI DSS, OWASP, CIS Controls
3. **Privacy & Data Protection Laws**: GDPR, HIPAA, CCPA, LGPD, and other regional privacy regulations
4. **Government & Defense Standards**: FedRAMP, CMMC, FISMA, DoD standards, and military requirements
5. **Industry-Specific Regulations**: Financial (SOX, GLBA), healthcare (HIPAA), critical infrastructure (NERC CIP)

Each suite represents either a vendor's product portfolio or a compliance/regulatory framework used for assessments and audits.

## Project Structure
```
/root/nfa-repos/zerobias/suite/
├── package/               # All suite packages (organized by vendor/framework)
│   ├── iso/27001/        # Example: ISO 27001 suite
│   ├── nist/800-53/      # Example: NIST 800-53 suite
│   └── ...               # Many more compliance frameworks
├── scripts/              # Build and automation scripts
├── templates/            # Templates for creating new suites
├── lerna.json           # Lerna configuration (independent versioning)
├── nx.json              # Nx configuration for build orchestration
├── package.json         # Root package configuration
└── README.md            # Main documentation
```

## Key Technologies
- **Lerna**: Manages multi-package repository versioning and publishing
- **Nx**: Build system for optimized task execution
- **Husky**: Git hooks for commit validation
- **TypeScript**: For validation scripts
- **Conventional Commits**: Enforced commit message format

## Important Commands

### Installation and Setup
```bash
# Initial setup (REQUIRED after cloning)
npm install  # Sets up husky hooks

# Set authentication token (REQUIRED)
export ZB_TOKEN=<your-zerobias-api-key>
```

### Development Commands
```bash
# Create a new suite
sh scripts/createNewSuite.sh <folder_path>

# Validate changes
npm run validate

# Bootstrap dependencies
npm run bootstrap

# Clean workspace
npm run clean        # Basic clean
npm run clean:full   # Full clean including node_modules
npm run reset        # Full reset and rebuild

# Correct dependencies
npm run correct:deps
```

### Lerna Commands
```bash
# Dry run to preview version changes
npm run lerna:dry-run

# Run tests across packages
npm run lerna:test

# Version packages (used in CI)
npm run lerna:version

# Publish packages (used in CI)
npm run lerna:publish
```

## Creating a New Suite

1. Create the folder structure:
   ```bash
   mkdir -p package/<vendor>/<framework_code>
   ```

2. Run the creation script:
   ```bash
   sh scripts/createNewSuite.sh package/<vendor>/<framework_code>
   ```

3. Navigate to the new suite and install dependencies:
   ```bash
   cd package/<vendor>/<framework_code>
   npm install
   npm shrinkwrap
   ```

4. Edit the following files with actual values:
   - `index.yml`: Replace placeholders for id, name, description, url
   - `package.json`: Ensure proper naming convention

5. Validate your changes:
   ```bash
   npm run validate  # Run from root directory
   ```

## Suite Package Structure
Each suite package must contain:
- `index.yml`: Suite metadata and configuration
- `package.json`: NPM package configuration
- `.npmrc`: NPM registry configuration
- `npm-shrinkwrap.json`: Locked dependencies
- `CHANGELOG.md`: Version history (auto-generated by Lerna)

### index.yml Structure
```yaml
id: <uuid>
name: <name>
type: suite
vendorId: <uuid>
vendorCode: <vendor_code>
vendorName: <vendor_name> # Optional
status: active
url: <official_url>
description: <description>
logo: <logo_url>  # Optional
```

### package.json Requirements
- Name format: `@zerobias-org/suite-<vendor>-<code>`
- Must include `auditmation` section:
  ```json
  "auditmation": {
    "import-artifact": "suite",
    "package": "<vendor>.<code>",
    "dataloader-version": "<version>"
  }
  ```
- Single dependency on vendor artifact: `@zerobias-org/vendor-<vendor>`

## Version Management

### Versioning Rules
- Start new suites at version `0.0.0`
- Lerna manages versioning automatically based on commits
- No manual version bumps in PRs
- For major version (1.0.0), use `premajor` label on PR

### Commit Conventions
All commits must follow Conventional Commits format:
```
<type>(<scope>): <subject>

<body>

<footer>
```

Types:
- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation changes
- `style`: Code style changes
- `refactor`: Code refactoring
- `perf`: Performance improvements
- `test`: Test additions/changes
- `chore`: Build/tooling changes

## GitHub Actions Workflows

### Pull Request Workflow
- Triggers on PR assignment, labeling, or merge
- Assigns to `nfci`: Runs lerna dry-run
- Label `premajor`: Creates release candidate
- On merge: Triggers publish workflow

### Publishing Process
1. Lerna publishes changed packages
2. Generates changelogs automatically
3. Tags and pushes to npm registry
4. Triggers post-publish notifications

## Registry Configuration
- Publishing to GitHub Packages: `https://npm.pkg.github.com/`
- Authentication via `ZB_TOKEN` environment variable

## Best Practices

1. **Always run `npm install` after cloning** to set up git hooks
2. **Set `ZB_TOKEN` environment variable** for npm authentication
3. **Follow conventional commits** - commits are validated by Husky
4. **Run validation** before pushing changes
5. **Use shrinkwrap** to lock dependencies
6. **Test locally** with `lerna:dry-run` before creating PRs

## Troubleshooting

### Common Issues
1. **Commit rejected**: Ensure commit message follows conventional format
2. **Validation fails**: Check index.yml and package.json requirements
3. **Build fails**: Run `npm run reset` to clean and rebuild
4. **Authentication fails**: Verify `ZB_TOKEN` is set correctly

### Validation Requirements
The validation script checks:
- index.yml has all required fields with proper values
- package.json follows naming conventions
- auditmation section is properly configured
- Dependencies include only the vendor artifact
- .npmrc file exists

## Current Branch Information
- Current branch: `initial-data`
- Main branch for PRs: (not specified, check with team)
- Recent commits show initial setup and fixes

## Additional Notes
- This is a multi-package monorepo with 200+ compliance framework packages
- Each package represents a different compliance standard
- Packages are independently versioned
- The repository uses both Lerna and Nx for optimal build performance